# 集水區降雨逕流模擬 (水筒模式)

這是一個用於集水區的降雨逕流模擬網頁應用程式。它採用了經典的「水筒模式」(Tank Model) 來模擬降雨如何轉化為集水區入流量，並提供了一套完整的使用者介面，讓使用者可以進行參數調整、自動校正與結果分析。

## 主要功能

### 1. 資料視覺化
- **降雨逕流歷線圖**: 以互動式圖表展示指定時間範圍內的觀測降雨、觀測流量與模擬流量。
- **事件快速導覽**: 提供「搜尋最高流量排行」與「搜尋日雨量排行」功能，讓使用者能快速跳轉至年度內的關鍵水文事件。
- **詳細數據表**: 在圖表下方提供可搜尋、可匯出 (CSV) 的詳細數據列表。
- **圖表匯出**: 可將目前的歷線圖匯出為 PNG 圖片。

### 2. 水筒模式模擬
- **參數可調**: 提供 11 個水筒模式參數的輸入介面，使用者可以即時修改並查看模擬結果。
- **即時模擬**: 點擊「執行演算」按鈕，即可使用當前參數進行模擬，並在圖表上繪製模擬流量歷線。
- **評估指標**: 模擬後，圖表下方會自動計算並顯示多項評估指標，包括：
  - 逕流係數 (Observed & Simulated)
  - 納什效率係數 (NSE)
  - 均方根誤差 (RMSE)
  - 尖峰流量誤差 (%)
  - 尖峰時間差 (hr)
  - 總量體積誤差 (%)

### 3. 參數自動校正
- **RPROP 演算法**: 內建 RPROP (Resilient Backpropagation) 演算法，可自動尋找最佳的水筒模式參數組合。
- **多目標函數**: 使用者可從下拉選單中選擇不同的校正目標：
  - **均方根誤差 (RMSE)**: 專注於整體誤差的最小化。
  - **效率係數 (NSE)**: 專注於讓模擬結果與觀測結果的趨勢盡可能一致 (目標為 1.0)。
  - **尖峰流量誤差**: 專注於讓模擬的洪峰流量盡可能接近觀測的洪峰流量。
- **校正進度顯示**: 校正過程中會顯示進度條與即時疊代資訊。
- **校正設定**: 提供彈出視窗，讓使用者可以微調 RPROP 演算法的參數 (如：最大疊代次數、初始步長等)。

### 4. 參數管理
- **儲存至瀏覽器**: 「儲存參數」按鈕可將當前參數儲存至瀏覽器的 `localStorage`，方便下次開啟時自動載入。同時也會觸發檔案下載作為備份。
- **從檔案載入**: 「載入參數」按鈕可從本機的 `.json` 檔案讀取參數設定。
- **下載成檔案**: 「下載參數」按鈕可將目前介面上的參數匯出為 `.json` 檔案。
- **恢復預設值**: 一鍵將所有參數恢復為程式內建的預設值。

### 5. 使用者體驗優化
- **說明提示 (Hint)**: 所有按鈕和參數輸入框在滑鼠懸停時都會顯示詳細的功能說明。
- **動態圖表標題**: 圖表標題會根據當前操作（顯示觀測資料、執行模擬、自動校正）動態變更。
- **非同步載入**: 資料讀取時會顯示載入動畫，避免畫面卡頓。
- **Toast 訊息**: 操作結果（如儲存成功、切換設定）會以不干擾操作的 Toast 訊息提示。
- **互動式圖表提示**: 滑鼠在圖表上移動時，提示框會同時顯示該時間點的觀測流量與模擬流量，方便即時比較。

## 如何使用

1.  將整個專案資料夾部署在一個網頁伺服器上 (例如 Live Server for VS Code)。
2.  用瀏覽器開啟 `tank_model_autopi.html`。
3.  **選擇日期**: 在上方的「開始日期」和「日數」選擇您想分析的時間範圍。
4.  **執行模擬**:
    - 直接點擊「執行演算」，使用預設參數進行模擬。
    - 或在「水筒模式參數」區塊修改參數後，再點擊「執行演算」。
5.  **自動校正**:
    - 在「自動校正」按鈕旁的下拉選單選擇您偏好的「目標函數」。
    - (可選) 點擊「校正設定」調整 RPROP 演算法參數。
    - 點擊「自動校正」按鈕，等待演算法完成。完成後，最佳化參數會自動填入介面並執行一次模擬。
6.  **管理參數**:
    - 點擊「儲存參數」將您的設定保存到瀏覽器並下載備份。
    - 點擊「載入參數」或「下載參數」來與他人分享或備份您的設定。

## 技術棧

- **前端框架**: HTML5, CSS3, Bootstrap 5
- **核心邏輯**: JavaScript (ES6 Modules)
- **圖表函式庫**: Flot.js
- **輔助函式庫**: jQuery (主要為 Flot.js 的依賴)

